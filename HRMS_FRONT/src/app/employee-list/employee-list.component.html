<!-- 顯示目前在哪個頁面 -->
<h4 class="page-title">員工清單</h4>

<!-- 小導覽條 -->
<div class="breadcrumb-container">
  <span class="breadcrumb" (click)="backToHome()">首頁</span>
  &nbsp;/&nbsp;
  @if (canViewEmployeeList()) {
  <span class="breadcrumb" (click)="backToEmployeeList()">員工清單</span>
  }
</div>

<div class="search-div-css">
  <!-- 部門的篩選器 -->
  <div class=" select-div-css">
    <span>部門</span>
    <select class="filter-css" [(ngModel)]="searchDepartment" (change)="searchDepartmentEventListener($event)">
      <option value="全部" selected>全部</option>
      @if(canShowBossSelect()){
      <option value="總經理">總經理</option>
      }
      @if(canShowHRSelect()){
      <option value="人資部門">人資部門</option>
      }
      @if(canShowAcctSelect()){
      <option value="會計部門">會計部門</option>
      }
      <option value="一般部門">一般部門</option>
    </select>

    <!-- 職等的篩選器 -->
    <span>職等</span>
    <select class="filter-css" [(ngModel)]="searchgrade" (change)="searchGradeEventListener($event)">
      <option [value]=-1>全部</option>
      @if(canShowBossSelect()){
      <option [value]="11">總經理</option>
      }
      @if(canShowManagerSelect()){
      <option [value]="6">主管</option>
      }
      <option [value]="1">員工</option>
    </select>

    <!-- 是否在職的篩選器 -->
    <span>在職狀態</span>
    <select class="filter-css" (change)="searchIsEmployedEventListener($event)"> -->
      <!-- 這裡的 [value] 是 屬性繫結，會傳入 boolean 真正的 true/false，而不是字串 "true" / "false" -->
      <option [value]=null>全部</option>
      <option [value]=true>在職中</option>
      <option [value]=false>已離職</option>
    </select>
  </div>
</div>

<div class="search-div-css">
  <!-- 員工編號的模糊搜尋 -->
  <div class="select-div-css">
    <span>員工編號</span>
    <input class="filter-css" type="text" placeholder="請輸入員工編號" [(ngModel)]="searchEmployeeId"
      (keyup)="onEmployeeIdKeyup($event)" />

    <!-- 員工姓名的模糊搜尋 -->
    <span>員工姓名</span>
    <input class="filter-css" type="text" placeholder="請輸入員工姓名" [(ngModel)]="searchEmployeeName"
      (keyup)="onEmployeeNameKeyup($event)" />
  </div>
</div>

<div class="create-employee-button-div">
  @if (canCreateEmployee()) {
  <!-- 新增員工的按鈕 -->
  <button type="button" class="btn create-employee-button" (click)="goToCreateEmployee()">新增員工</button>
  }
</div>

<!-- 公司員工清單的表格 -->
<div class="employee-box-css">
  <table mat-table [dataSource]="dataSource" matSort>
    <!-- 編輯的按鈕 -->
    @if (canEditAnyEmployee()) {
    <ng-container matColumnDef="editEmployee">
      <th mat-header-cell *matHeaderCellDef>編輯</th>
      <td mat-cell *matCellDef="let employee">
        @if (canEdit(employee) && !isCurrentUser(employee)) {
        <button mat-icon-button (click)="goToEmployeeEdit(employee)">
          <mat-icon>edit</mat-icon>
        </button>
        }
      </td>
    </ng-container>
    }

    <!-- 員工編號的行 -->
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef mat-sort-header style="font-size: 18px;">員工編號</th>
      <td mat-cell *matCellDef="let employee" style="font-size: 18px;"> {{ employee.id }} </td>
    </ng-container>

    <!-- 部門的行 -->
    <ng-container matColumnDef="department">
      <th mat-header-cell *matHeaderCellDef style="font-size: 18px;">部門</th>
      <td mat-cell *matCellDef="let employee" style="font-size: 18px;"> {{ getDepartmentText(employee.department) }}
      </td>
    </ng-container>

    <!-- 職等的行 -->
    <ng-container matColumnDef="grade">
      <th mat-header-cell *matHeaderCellDef style="font-size: 18px;">職等</th>
      <td mat-cell *matCellDef="let employee" style="font-size: 18px;"> {{ getGradeText(employee) }} </td>
    </ng-container>

    <!-- 員工姓名的行 -->
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef style="font-size: 18px;">員工姓名</th>
      <td mat-cell *matCellDef="let employee" style="font-size: 18px;"> {{ employee.name }} </td>
    </ng-container>

    <!-- 詳細資訊的行 -->
    @if (canViewDetail()) {
    <ng-container matColumnDef="detail">
      <th mat-header-cell *matHeaderCellDef style="font-size: 18px;">詳細資訊</th>
      <td mat-cell *matCellDef="let employee" style="font-size: 18px;">
        <button mat-icon-button (click)="goToDetail(employee)">
          <mat-icon>contact_page</mat-icon>
        </button>
      </td>
    </ng-container>
    }

    <!-- 計算薪資的行 -->
    <ng-container matColumnDef="salary">
      <th mat-header-cell *matHeaderCellDef style="font-size: 18px;">薪資管理</th>
      <td mat-cell *matCellDef="let employee" style="font-size: 18px;">
        @if (canShowSalaryButton(employee)) {
        <button mat-icon-button (click)="goToSalaryManagement(employee)">
          <mat-icon>attach_money</mat-icon>
        </button>
        }
      </td>
    </ng-container>

    <!-- class="header-row-style"為更改第一列底色 -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns" class="header-row-style"></tr>
    <!-- 斑馬紋: 滑鼠在某一欄，那一欄會出現底色 -->
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"
      [ngClass]="{'resigned-row': !row.employed, 'zebra-row': row.employed}">
    </tr>
  </table>

  <!-- 表格一次會顯示幾筆資料，[5, 10, 20]可更改一頁顯示的數量 -->
  <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons aria-label="Select page of periodic elements">
  </mat-paginator>